@page "/Rabotniks/Create"
@using BlazorApp2.Models
@inject BlazorApp2Context _context
@using Microsoft.EntityFrameworkCore
@inject NavigationManager NavigationManager
@inject IWebHostEnvironment _env
<h1 class="t">Внести Работника</h1>
<br />
<EditForm Model="newRabotnik" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div class="row">
        <div class="col-md-4">
            <div class="form-group">
                <label for="surname" class="control-label">Фамилия</label>
                <InputText id="surname" @bind-Value="newRabotnik.Фамилия" />
            </div>
            <div class="form-group">
                <label for="name" class="control-label">Имя</label>
                <InputText id="name" @bind-Value="newRabotnik.Имя" />
            </div>
            <div class="form-group">
                <label for="patronymic" class="control-label">Отчество</label>
                <InputText id="patronymic" @bind-Value="newRabotnik.Отчество" />
            </div>
            <div class="form-group">
                <label for="height" class="control-label">Рост</label>
                <InputNumber id="height" @bind-Value="newRabotnik.Рост" />
            </div>
            <div class="form-group">
                <label for="dolj" class="control-label">Должность</label>
                <InputText id="dolj" @bind-Value="newRabotnik.Должность" />
            </div>
            <div class="form-group">
                <label for="staj" class="control-label">Стаж</label>
                <InputNumber id="staj" @bind-Value="newRabotnik.Стаж" />
            </div>
            <div class="form-group">
                <label for="plan" class="control-label">Планета_происхождения</label>
                <InputText id="plan" @bind-Value="newRabotnik.Планета_происхождения" />
            </div>
            <div class="form-group">
                <label for="obr" class="control-label">Образование</label>
                <InputText id="obr" @bind-Value="newRabotnik.Образование" />
            </div>
            <div class="form-group">
                <label for="age" class="control-label">Возраст</label>
                <InputNumber id="age" @bind-Value="newRabotnik.Возраст" />
            </div>
            <div class="form-group">
                <div class="n">
                    <label for="photo" class="control-label">Фото (менее 500кб)</label>
                    <InputFile id="photo" OnChange="@OnInputFileChange" accept=".jpg,.jpeg,.png,.gif" />
                </div>
            </div>
            <br />
            <button type="submit" class="btn btn-success">Добавить работника</button>
            <br />
            <div class="form-group">
                <NavLink class="nav-link" href="/Rabotniks/Index">
                    <div class="n">
                    <span class="oi oi-minus" aria-hidden="true"></span> Вернуться к Просмотру
                    </div>
                </NavLink>
            </div>
        </div>
    </div>
</EditForm>
@code {
    private Rabotnik newRabotnik = new Rabotnik();

    private async Task HandleValidSubmit()
    {
        _context.Rabotnik.Add(newRabotnik);
        await _context.SaveChangesAsync();

        NavigationManager.NavigateTo("/Rabotniks/Index");
    }
    private async Task OnInputFileChange(InputFileChangeEventArgs e)
    {
        var path = Path.Combine(_env.WebRootPath, "imgbaserabot", e.File.Name);
        using (var stream = new FileStream(path, FileMode.Create))
        {
            await e.File.OpenReadStream().CopyToAsync(stream);
        }
        newRabotnik.Фото = Path.Combine("imgbaserabot", e.File.Name);
    }
}